package sk.stuba.fei.feidroid.services.criteria;

import java.util.ArrayList;
import java.util.List;

import javax.persistence.criteria.CriteriaBuilder;
import javax.persistence.criteria.Order;
import javax.persistence.criteria.Predicate;
import javax.persistence.criteria.Root;

import sk.stuba.fei.feidroid.entities.Application;
import sk.stuba.fei.feidroid.entities.Application_;

public class MalwareCriteria implements Criteria<Application> {
	public static final String MALWARE_DESCRIPTION = "malware";
	private boolean excludeMalware;

	public MalwareCriteria() {
		excludeMalware = false;
	}

	public MalwareCriteria(boolean excludeMalware) {
		this.excludeMalware = excludeMalware;
	}

	@Override
	public boolean applyTo(Application entity) {
		return excludeMalware ^ MALWARE_DESCRIPTION.equals(entity.getDescription());
	}

	@Override
	public Predicate toPredicate(Root<Application> root, CriteriaBuilder cb) {
		if (excludeMalware) {
			return cb.notEqual(root.get(Application_.description), MALWARE_DESCRIPTION);
		} else {
			return cb.equal(root.get(Application_.description), MALWARE_DESCRIPTION);
		}
	}

	@Override
	public List<Order> getOrderBy(Root<Application> root, CriteriaBuilder cb) {
		List<Order> order = new ArrayList<Order>();
		order.add(cb.desc(root.get(Application_.appPackage)));
		return order;
	}

}
